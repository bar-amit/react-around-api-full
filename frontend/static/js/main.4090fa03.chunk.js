(this["webpackJsonparound-react"]=this["webpackJsonparound-react"]||[]).push([[0],{20:function(e,t,n){},23:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),c=n(13),i=n.n(c),s=n(6),o=(n(20),n(7)),l=n.n(o),u=n(9),d=n(11),p=n(4),j=n(3),m=n(2),b=Object(a.createContext)(),h=n.p+"static/media/header__logo_large.4e8e0a1d.svg",_=n(0);var f=function(e){var t=e.onLogout,n=Object(a.useContext)(b).email,r=Object(m.g)();return Object(_.jsxs)("header",{className:"header",children:[Object(_.jsx)("img",{className:"header__logo",src:h,alt:"Around the U.S. logo"}),n?Object(_.jsx)("nav",{children:Object(_.jsxs)("ul",{className:"header__nav",children:[Object(_.jsx)("li",{children:Object(_.jsx)("p",{className:"header__email",children:n})}),Object(_.jsx)("li",{className:"header__link",onClick:t,children:"Log out"})]})}):Object(_.jsx)("nav",{children:Object(_.jsx)("ul",{className:"header__nav",children:"/login"===r.pathname?Object(_.jsx)("li",{children:Object(_.jsx)(s.b,{className:"header__link",to:"register",children:"Sign up"})}):Object(_.jsx)("li",{children:Object(_.jsx)(s.b,{className:"header__link",to:"login",children:"Log in"})})})})]})};var O=function(e){var t,n,r=e.data,c=e.onCardClick,i=e.onCardLike,s=e.onCardDelete,o=Object(a.useContext)(b)._id,l=o===r.owner,u=null===(t=r.likes)||void 0===t?void 0:t.some((function(e){return e===o}));return Object(_.jsxs)("li",{className:"card",children:[l?Object(_.jsx)("button",{className:"card__delete-button",type:"button","aria-label":"delete",onClick:function(){return s(r)}}):"",Object(_.jsx)("img",{className:"card__image",src:r.link,alt:r.name,onClick:function(){return c(r)}}),Object(_.jsxs)("div",{className:"card__panel",children:[Object(_.jsx)("h2",{className:"card__title",children:r.name}),Object(_.jsxs)("div",{className:"card__like",children:[Object(_.jsx)("button",{className:"card__like-button ".concat(u?"card__like-button_active":""),type:"button","aria-label":"Like",onClick:function(){return i(r)}}),Object(_.jsx)("p",{className:"card__like-counter",children:(null===(n=r.likes)||void 0===n?void 0:n.length)||"0"})]})]})]})},x=n.p+"static/media/profile__image.453c0ae5.jpg";var g=function(e){var t=e.onEditProfileClick,n=e.onAddPlaceClick,a=e.onEditAvatarClick,c=e.onCardClick,i=e.onCardLike,s=e.onCardDelete,o=e.cardsList,l=r.a.useContext(b),u=l.name,d=l.avatar,p=l.about;return Object(_.jsxs)("main",{className:"main",children:[Object(_.jsxs)("section",{className:"profile",children:[Object(_.jsx)("button",{className:"profile__avatar",type:"button",onClick:a,children:Object(_.jsx)("img",{className:"profile__image",src:d||x,alt:"profile"})}),Object(_.jsxs)("div",{className:"profile__info",children:[Object(_.jsx)("h1",{className:"profile__name",children:u||"Please be patient"}),Object(_.jsx)("button",{className:"profile__edit-button",type:"button","aria-label":"Edit profile",onClick:t}),Object(_.jsx)("p",{className:"profile__bio",children:p||"We are fetching your user info..."})]}),Object(_.jsx)("button",{className:"profile__add-button",type:"button","aria-label":"Add an item",onClick:n})]}),Object(_.jsx)("section",{className:"gallery",children:Object(_.jsx)("ul",{className:"gallery__container",children:o.map((function(e){return Object(_.jsx)(O,{data:e,onCardClick:c,onCardLike:i,onCardDelete:s},e._id)}))})})]})};var v=function(){return Object(_.jsx)("footer",{className:"footer",children:Object(_.jsx)("p",{className:"footer__copyrighs",children:"\xa9 2021 Around The U.S."})})};var k=function(e){var t=e.title,n=e.name,a=e.buttonText,c=e.isOpen,i=e.onClose,s=e.onSubmit,o=e.children,l=r.a.useState(a),u=Object(j.a)(l,2),d=u[0],p=u[1];return Object(_.jsx)("div",{className:"popup popup_name_".concat(n," ").concat(c?"popup_visible":""),onClick:function(e){e.target.classList.contains("popup_visible")&&i()},children:Object(_.jsxs)("div",{className:"popup__container",children:[Object(_.jsx)("button",{className:"popup__close-button popup__close-button_shrink",type:"button","aria-label":"close",onClick:i}),Object(_.jsx)("h2",{className:"popup__title",children:t}),Object(_.jsxs)("form",{className:"form form_name_".concat(n),name:n,onSubmit:function(e){e.preventDefault(),p("Saving..."),s().then((function(){return p(a)}))},children:[o,Object(_.jsx)("button",{className:"form__save-button",type:"submit",children:d})]})]})})};var C=function(e){var t=e.title,n=e.name,r=e.buttonText,c=e.isOpen,i=e.onClose,s=e.onSubmit,o=Object(a.useContext)(b),l=o.name,u=o.about,d=Object(a.useState)(l),p=Object(j.a)(d,2),m=p[0],h=p[1],f=Object(a.useState)(u),O=Object(j.a)(f,2),x=O[0],g=O[1];function v(e){"name"===e.target.name?h(e.target.value):g(e.target.value)}return Object(a.useEffect)((function(){g(u),h(l)}),[l,u,c]),Object(_.jsxs)(k,{title:t,name:n,buttonText:r,isOpen:c,onClose:i,onSubmit:function(){return s({name:m,about:x})},children:[Object(_.jsxs)("label",{className:"form__field",children:[Object(_.jsx)("input",{id:"input_name",className:"form__input form__input_type_name",value:m,type:"text",name:"name",placeholder:"Name",minLength:"2",maxLength:"40",required:!0,onChange:v}),Object(_.jsx)("span",{id:"input_name-error",className:"form__input-error"})]}),Object(_.jsxs)("label",{className:"form__field",children:[Object(_.jsx)("input",{id:"input_bio",className:"form__input form__input_type_bio",value:x,type:"text",name:"bio",placeholder:"About me",minLength:"2",maxLength:"200",required:!0,onChange:v}),Object(_.jsx)("span",{id:"input_bio-error",className:"form__input-error"})]})]})};var N=function(e){var t=e.title,n=e.name,r=e.buttonText,c=e.isOpen,i=e.onClose,s=e.onSubmit,o=Object(a.useRef)();return Object(_.jsx)(k,{title:t,name:n,buttonText:r,isOpen:c,onClose:i,onSubmit:function(){return s(o.current.value)},children:Object(_.jsxs)("label",{className:"form__field",children:[Object(_.jsx)("input",{id:"input_url",className:"form__input form__input_type_url",ref:o,type:"url",name:"url",placeholder:"Image URL",required:!0}),Object(_.jsx)("span",{id:"input_url-error",className:"form__input-error"})]})})};var S=function(e){var t=e.title,n=e.name,r=e.buttonText,c=e.isOpen,i=e.onClose,s=e.onSubmit,o=Object(a.useState)(""),l=Object(j.a)(o,2),u=l[0],d=l[1],p=Object(a.useState)(""),m=Object(j.a)(p,2),b=m[0],h=m[1];function f(e){"title"===e.target.name?d(e.target.value):h(e.target.value)}return Object(a.useEffect)((function(){d(""),h("")}),[c]),Object(_.jsxs)(k,{title:t,name:n,buttonText:r,isOpen:c,onClose:i,onSubmit:function(){return s({name:u,link:b})},children:[Object(_.jsxs)("label",{className:"form__field",children:[Object(_.jsx)("input",{id:"input_title",className:"form__input form__input_type_title",value:u,type:"text",name:"title",placeholder:"Title",minLength:"1",maxLength:"30",required:!0,onChange:f}),Object(_.jsx)("span",{id:"input_title-error",className:"form__input-error"})]}),Object(_.jsxs)("label",{className:"form__field",children:[Object(_.jsx)("input",{id:"input_link",className:"form__input form__input_type_link",value:b,type:"url",name:"link",placeholder:"Image link",required:!0,onChange:f}),Object(_.jsx)("span",{id:"input_link-error",className:"form__input-error"})]})]})};var y=function(e){var t=e.card,n=e.onClose;return Object(_.jsx)("div",{className:"popup popup_name_picture ".concat(t.link?"popup_visible":""),onClick:function(e){e.target.classList.contains("popup_visible")&&n()},children:Object(_.jsxs)("div",{className:"popup__picture-container",children:[Object(_.jsx)("button",{className:"popup__close-button",type:"button","aria-label":"close",onClick:n}),Object(_.jsx)("img",{className:"popup__picture",src:t.link,alt:t.name}),Object(_.jsx)("h2",{className:"popup__picture-title",children:t.name})]})})};var T=function(e){var t=e.handleFormSubmit,n=e.formTitle,r=e.formName,c=e.linkText,i=Object(a.useState)(n),o=Object(j.a)(i,2),l=o[0],u=o[1],d=Object(a.useState)(""),p=Object(j.a)(d,2),m=p[0],b=p[1],h=Object(a.useState)(""),f=Object(j.a)(h,2),O=f[0],x=f[1];function g(e){"email"===e.target.name?b(e.target.value):x(e.target.value)}return Object(_.jsx)("main",{className:"main",children:Object(_.jsxs)("section",{className:"user-form",children:[Object(_.jsx)("h2",{className:"user-form__title",children:n}),Object(_.jsxs)("form",{className:"form form_name_".concat(r," user-form__form"),name:r,onSubmit:function(e){e.preventDefault(),u("Sending..."),t({email:m,password:O})},children:[Object(_.jsxs)("div",{className:"user-form__section",children:[Object(_.jsxs)("label",{className:"form__field",children:[Object(_.jsx)("input",{id:"input_email",className:"user-form__input",value:m,type:"email",name:"email",placeholder:"Email",minLength:"2",maxLength:"40",required:!0,onChange:g}),Object(_.jsx)("span",{id:"input_password-error",className:"form__input-error"})]}),Object(_.jsxs)("label",{className:"form__field",children:[Object(_.jsx)("input",{id:"input_password",className:"user-form__input",value:O,type:"password",name:"password",placeholder:"Password",minLength:"2",maxLength:"200",required:!0,onChange:g}),Object(_.jsx)("span",{id:"input_password-error",className:"form__input-error"})]})]}),Object(_.jsxs)("div",{className:"user-form__section",children:[Object(_.jsx)("button",{className:"user-form__button",type:"submit",children:l}),Object(_.jsx)(s.b,{to:"signin"===r?"/register":"/login",className:"user-form__link",children:c})]})]})]})})};var w=function(e){var t=e.handleLogin;return Object(_.jsx)(T,{handleFormSubmit:t,formTitle:"Sign in",formName:"signin",linkText:"Not a member yet? Sign up here!"})};function L(e){var t=e.handleRegistration;return Object(_.jsx)(T,{handleFormSubmit:t,formTitle:"Sign up",formName:"register",linkText:"Already a member? Log in here!"})}function E(e){var t=e.children,n=Object(a.useContext)(b).signedIn,r=Object(m.g)();return n?t:Object(_.jsx)(m.a,{to:"/login",from:r})}var I=n.p+"static/media/info-tooltip__succeed.1b6082f8.svg",P=n.p+"static/media/info-tooltip__fail.df8eddf6.svg";var A=function(e){var t=e.hasSucceed,n=e.isOpen,a=e.onClose,r="Success! You have now been registered.",c="Oops, something went wrong! Please try again.";return Object(_.jsx)("div",{className:"popup popup_name_info-tooltip ".concat(n?"popup_visible":""),onClick:function(e){e.target.classList.contains("popup_visible")&&a()},children:Object(_.jsxs)("div",{className:"popup__container",children:[Object(_.jsx)("button",{className:"popup__close-button popup__close-button_shrink popup__close-button_centered",type:"button","aria-label":"close",onClick:a}),Object(_.jsx)("img",{className:"popup__tooltip-icon",src:t?I:P,alt:t?"Operation succeed":"Operation failed"}),Object(_.jsx)("h2",{className:"popup__title popup__title_centered",children:t?r:c})]})})},R=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).authBaseUrl,D=void 0===R?"https://api.bar-around.students.nomoreparties.sbs":R;function U(e){return e.ok?e.json():Promise.reject("error: ".concat(e.status,", ").concat(e.statusText))}function F(){return(F=Object(u.a)(l.a.mark((function e(t){var n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.password,a=t.email,e.abrupt("return",fetch("".concat(D,"/signup"),{method:"POST",headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/json"},body:JSON.stringify({password:n,email:a})}).then(U));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(){return(q=Object(u.a)(l.a.mark((function e(t){var n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.email,a=t.password,e.abrupt("return",fetch("".concat(D,"/signin"),{method:"POST",headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/json"},body:JSON.stringify({password:a,email:n})}).then(U));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var J={checkToken:function(e){var t=e.token;return fetch("".concat(D,"/users/me"),{method:"GET",headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/json",Authorization:"Bearer ".concat(t)}}).then(U)},logout:function(){removeToken(),J.isSignedIn=!1,J.user={email:null,id:null}},signup:function(e){return F.apply(this,arguments)},signin:function(e){return q.apply(this,arguments)}},B=n(14),H=n(15),z=function(){function e(t){var n=t.host,a=t.authorization;Object(B.a)(this,e),this._host=n,this._headers={authorization:a},this.userId=void 0}return Object(H.a)(e,[{key:"_handleResponse",value:function(e){return e.ok?e.json():Promise.reject("error: ".concat(e.status,", ").concat(e.statusText))}},{key:"getUserInfo",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"me";return fetch("".concat(this._host,"/users/").concat(t),{headers:this._headers}).then(this._handleResponse).then((function(t){return e.userId=t._id,t}))}},{key:"updateUserAvatar",value:function(e){return fetch("".concat(this._host,"/users/me/avatar"),{method:"PATCH",headers:Object(p.a)(Object(p.a)({},this._headers),{},{"Content-Type":"application/json"}),body:JSON.stringify({avatar:e})}).then(this._handleResponse)}},{key:"updateUser",value:function(e){var t=e.name,n=e.about;return fetch("".concat(this._host,"/users/me"),{method:"PATCH",headers:Object(p.a)(Object(p.a)({},this._headers),{},{"Content-Type":"application/json"}),body:JSON.stringify({name:t,about:n})}).then(this._handleResponse)}},{key:"getCards",value:function(){return fetch("".concat(this._host,"/cards"),{headers:this._headers}).then(this._handleResponse)}},{key:"addCard",value:function(e){var t=e.name,n=e.link;return fetch("".concat(this._host,"/cards"),{method:"POST",headers:Object(p.a)(Object(p.a)({},this._headers),{},{"Content-Type":"application/json"}),body:JSON.stringify({name:t,link:n})}).then(this._handleResponse)}},{key:"deleteCard",value:function(e){return fetch("".concat(this._host,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then(this._handleResponse)}},{key:"addLike",value:function(e){return fetch("".concat(this._host,"/cards/").concat(e,"/likes"),{method:"PUT",headers:this._headers}).then(this._handleResponse)}},{key:"removeLike",value:function(e){return fetch("".concat(this._host,"/cards/").concat(e,"/likes"),{method:"DELETE",headers:this._headers}).then(this._handleResponse)}}]),e}(),W=function(e){return new z({host:"https://api.bar-around.students.nomoreparties.sbs",authorization:"Bearer ".concat(e)})};var K=function(){var e=r.a.useState({signedIn:null,email:"",name:"",about:"",_id:""}),t=Object(j.a)(e,2),n=t[0],a=t[1],c=r.a.useState([]),i=Object(j.a)(c,2),s=i[0],o=i[1],h=Object(m.h)(),O=r.a.useState(!1),x=Object(j.a)(O,2),T=x[0],I=x[1],P=r.a.useState(!1),R=Object(j.a)(P,2),D=R[0],U=R[1],F=r.a.useState(!1),q=Object(j.a)(F,2),B=q[0],H=q[1],z=r.a.useState({isOpen:!1,cardId:""}),K=Object(j.a)(z,2),Y=K[0],G=K[1],M=r.a.useState({isOpen:!1,hasSucceed:!1}),V=Object(j.a)(M,2),Q=V[0],X=V[1],Z=r.a.useState({}),$=Object(j.a)(Z,2),ee=$[0],te=$[1],ne=function(){I(!1),U(!1),H(!1),te({}),X(Object(p.a)(Object(p.a)({},Q),{},{isOpen:!1}))};r.a.useEffect((function(){var e=function(e){"Escape"===e.key&&ne()};return document.addEventListener("keydown",e),function(){return document.removeEventListener("keydown",e)}}),[]);var ae=W(localStorage.getItem("jwt"));function re(){return ae.getUserInfo().then((function(e){return a(Object(p.a)(Object(p.a)({},n),{},{signedIn:!0},e)),!0})).catch((function(e){return Promise.reject("Token is not valid")}))}function ce(e){var t=e.email,r=e.password;J.signin({email:t,password:r}).then((function(e){!function(e){var t=e.token;localStorage.setItem("jwt",t)}(e),ae=W(localStorage.getItem("jwt")),a(Object(p.a)(Object(p.a)({},n),{},{signedIn:!0})),h("/",{replace:!0})})).catch((function(){X({isOpen:!0,hasSucceed:!1})}))}function ie(){return(ie=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,re();case 3:e.sent?h("/",{replace:!0}):a(Object(p.a)(Object(p.a)({},n),{},{signedIn:!1})),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),a(Object(p.a)(Object(p.a)({},n),{},{signedIn:!1})),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}return r.a.useEffect((function(){null===n.signedIn&&function(){ie.apply(this,arguments)}(),n.signedIn&&Promise.all([ae.getCards().then((function(e){return o(e)})).catch((function(e){return console.log(e)})),re()]).catch((function(e){return console.log(e)}))}),[n.signedIn]),Object(_.jsxs)(_.Fragment,{children:[Object(_.jsxs)(b.Provider,{value:n,children:[Object(_.jsx)(f,{onLogout:function(){localStorage.removeItem("jwt"),a(Object(p.a)(Object(p.a)({},n),{},{signedIn:!1,email:null}))}}),Object(_.jsxs)(m.e,{children:[Object(_.jsx)(m.c,{path:"/login",element:Object(_.jsx)(w,{handleLogin:ce})}),Object(_.jsx)(m.c,{path:"/register",element:Object(_.jsx)(L,{handleRegistration:function(e){var t=e.email,n=e.password;J.signup({email:t,password:n}).then((function(e){if(e.error)throw new Error({message:"Failed to register"});X({isOpen:!0,hasSucceed:!0}),ce({email:t,password:n})})).catch((function(){X({isOpen:!0,hasSucceed:!1})}))}})}),Object(_.jsx)(m.c,{path:"/*",element:Object(_.jsx)(E,{children:Object(_.jsx)(g,{onEditProfileClick:function(){return I(!0)},onAddPlaceClick:function(){return U(!0)},onEditAvatarClick:function(){return H(!0)},onCardClick:function(e){return te(e)},onCardLike:function(e){(e.likes.some((function(e){return e._id===n._id}))?ae.removeLike(e._id):ae.addLike(e._id)).then((function(e){var t=s.findIndex((function(t){return t._id===e._id}));o([].concat(Object(d.a)(s.slice(0,t)),[e],Object(d.a)(s.slice(t+1))))})).catch((function(e){return console.log(e)}))},onCardDelete:function(e){G({isOpen:!0,cardId:e._id})},cardsList:s})})})]}),Object(_.jsx)(m.b,{}),Object(_.jsx)(A,Object(p.a)(Object(p.a)({},Q),{},{onClose:ne})),Object(_.jsx)(C,{title:"Edit profile",name:"edit-profile",buttonText:"Save",isOpen:T,onClose:ne,onSubmit:function(e){var t=e.name,r=e.about;return ae.updateUser({name:t,about:r}).then((function(e){return a(Object(p.a)(Object(p.a)({},n),e))})).then((function(){return I(!1)})).catch((function(e){return console.log(e)}))}}),Object(_.jsx)(S,{title:"New Place",name:"new-place",buttonText:"Create",isOpen:D,onClose:ne,onSubmit:function(e){var t=e.name,n=e.link;return ae.addCard({name:t,link:n}).then((function(e){return o([e].concat(Object(d.a)(s)))})).then((function(){return U(!1)})).catch((function(e){return console.log(e)}))}}),Object(_.jsx)(N,{title:"Change profile picture",name:"edit-avatar",buttonText:"Save",isOpen:B,onClose:ne,onSubmit:function(e){return ae.updateUserAvatar(e).then((function(e){var t=e.avatar;return a(Object(p.a)(Object(p.a)({},n),{},{avatar:t}))})).then((function(){return H(!1)})).catch((function(e){return console.log(e)}))}}),Object(_.jsx)(k,{title:"Are you sure?",name:"confirm",buttonText:"Yes",isOpen:Y.isOpen,onClose:ne,onSubmit:function(){var e=Y.cardId;return ae.deleteCard(e).then((function(){return o(s.filter((function(t){return t._id!==e})))})).then((function(){return G({isOpen:!1,cardId:""})})).catch((function(e){return console.log(e)}))}}),Object(_.jsx)(y,{card:ee,onClose:ne})]}),Object(_.jsx)(v,{})]})},Y=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,24)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),a(e),r(e),c(e),i(e)}))};i.a.render(Object(_.jsx)(r.a.StrictMode,{children:Object(_.jsx)(s.a,{children:Object(_.jsx)(K,{})})}),document.getElementById("root")),Y()}},[[23,1,2]]]);
//# sourceMappingURL=main.4090fa03.chunk.js.map